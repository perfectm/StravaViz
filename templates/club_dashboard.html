<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strava Club Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        header {
            background: linear-gradient(135deg, #fc4c02, #ff7043);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
        }

        nav ul {
            list-style: none;
            display: flex;
            gap: 2rem;
        }

        nav a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: background-color 0.3s ease;
        }

        nav a:hover {
            background-color: rgba(255,255,255,0.2);
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255,255,255,0.9);
            padding: 0.5rem 1rem;
        }

        .profile-pic {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.5);
        }

        .profile-placeholder {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        main {
            padding: 2rem 0;
        }

        .section {
            background: white;
            margin: 2rem 0;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .section h2 {
            color: #fc4c02;
            margin-bottom: 1.5rem;
            font-size: 1.8rem;
            border-bottom: 3px solid #fc4c02;
            padding-bottom: 0.5rem;
        }

        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .data-table {
            margin-bottom: 2rem;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .chart-container {
            text-align: center;
            margin: 1rem 0;
        }

        .chart-container img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .no-data {
            text-align: center;
            color: #666;
            font-style: italic;
            padding: 2rem;
        }

        .warning-banner {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            nav ul {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .overview-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">üîí Strava Club Dashboard</div>
                <nav>
                    <ul>
                        <li><a href="/dashboard">My Dashboard</a></li>
                        <li><a href="/club">Club View</a></li>
                        {% if user %}
                        <li><a href="/settings">Settings</a></li>
                        <li class="user-profile">
                            {% if user.profile_picture %}
                            <img src="{{ user.profile_picture }}" alt="Profile" class="profile-pic">
                            {% else %}
                            <div class="profile-placeholder">üë§</div>
                            {% endif %}
                            <span>{{ user.firstname }} {{ user.lastname }}</span>
                        </li>
                        <li><a href="/auth/logout" style="background: rgba(255,255,255,0.2);">Logout</a></li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <main>
        <div class="container">
            <section class="section">
                <h2>Club Overview (Club ID: {{ club_id }})</h2>
                <div class="warning-banner">
                    <strong>‚ö†Ô∏è Note:</strong> Club data is limited by the Strava API. Names show as "FirstName L." format,
                    and only recent activities are available without timestamps. For full data access, consider implementing
                    individual athlete authentication.
                </div>
                <div class="overview-grid">
                    <div class="stat-card">
                        <div class="stat-value">{{ total_activities }}</div>
                        <div class="stat-label">Total Activities</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ total_distance_km }}</div>
                        <div class="stat-label">Total Distance (km)</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ total_duration_hours }}</div>
                        <div class="stat-label">Total Duration (hrs)</div>
                    </div>
                </div>
                <div class="overview-grid" style="margin-top: 20px;">
                    <div class="stat-card">
                        <div class="stat-value">{{ walk_count }}</div>
                        <div class="stat-label">üö∂ Walks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ hike_count }}</div>
                        <div class="stat-label">ü•æ Hikes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ run_count }}</div>
                        <div class="stat-label">üèÉ Runs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">{{ ride_count }}</div>
                        <div class="stat-label">üö¥ Rides</div>
                    </div>
                </div>
            </section>

            {% if leaderboard_chart %}
            <section class="section">
                <h2>üèÜ Leaderboard - Top Athletes (This Week)</h2>
                <div class="chart-container">
                    <img src="data:image/png;base64,{{ leaderboard_chart }}" alt="Club Leaderboard"/>
                </div>
                {% if weekly_leaderboard %}
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Athlete</th>
                                <th>Activities</th>
                                <th>Distance (km)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for athlete in weekly_leaderboard %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ athlete['athlete.firstname'] }}</td>
                                <td>{{ athlete['activity_count'] }}</td>
                                <td>{{ athlete['total_distance_km']|round(2) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </section>
            {% endif %}

            {% if weekly_leaderboard and weekly_leaderboard|length > 0 %}
            <section class="section">
                <h2>üî• Weekly Leaderboard - Current Week</h2>
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Athlete</th>
                                <th>Activities</th>
                                <th>Distance (km)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for athlete in weekly_leaderboard %}
                            <tr>
                                <td>{{ loop.index }}</td>
                                <td>{{ athlete['athlete.firstname'] }}</td>
                                <td>{{ athlete['activity_count'] }}</td>
                                <td>{{ athlete['total_distance_km']|round(2) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            {% if trophy_leaderboard and trophy_leaderboard|length > 0 %}
            <section class="section">
                <h2>üèÜ Weekly Trophy Leaderboard - All Time</h2>
                <p style="color: #666; margin-bottom: 20px;">Athletes are awarded a trophy for having the longest distance each week (Monday-Sunday). Ties result in multiple trophies awarded.</p>
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Athlete</th>
                                <th>üèÜ Trophies</th>
                                <th>Total Winning Distance (km)</th>
                                <th>First Trophy</th>
                                <th>Latest Trophy</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for athlete in trophy_leaderboard %}
                            <tr {% if loop.index == 1 %}style="background-color: #fff9e6;"{% endif %}>
                                <td>
                                    {% if loop.index == 1 %}ü•á
                                    {% elif loop.index == 2 %}ü•à
                                    {% elif loop.index == 3 %}ü•â
                                    {% else %}{{ loop.index }}{% endif %}
                                </td>
                                <td><strong>{{ athlete['firstname'] }} {{ athlete['lastname'] }}</strong></td>
                                <td><strong>{{ athlete['trophy_count'] }}</strong></td>
                                <td>{{ (athlete['total_winning_distance'] / 1000)|round(2) }}</td>
                                <td>{{ athlete['first_trophy'] }}</td>
                                <td>{{ athlete['latest_trophy'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            {% if recent_trophy_winners and recent_trophy_winners|length > 0 %}
            <section class="section">
                <h2>üéñÔ∏è Recent Weekly Champions</h2>
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Week</th>
                                <th>Champion</th>
                                <th>Distance (km)</th>
                                <th>Activities</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for winner in recent_trophy_winners %}
                            <tr>
                                <td>{{ winner['week_start'] }} to {{ winner['week_end'] }}</td>
                                <td>üèÜ <strong>{{ winner['firstname'] }} {{ winner['lastname'] }}</strong></td>
                                <td>{{ (winner['total_distance'] / 1000)|round(2) }}</td>
                                <td>{{ winner['activity_count'] }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}

            {% if type_chart %}
            <section class="section">
                <h2>üìä Activity Type Distribution</h2>
                <div class="chart-container">
                    <img src="data:image/png;base64,{{ type_chart }}" alt="Activity Type Distribution"/>
                </div>
            </section>
            {% endif %}

            {% if recent_activities %}
            <section class="section">
                <h2>üìÖ Recent Club Activities</h2>
                <div class="data-table">
                    <table>
                        <thead>
                            <tr>
                                <th>Athlete</th>
                                <th>Activity</th>
                                <th>Type</th>
                                <th>Distance (km)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for activity in recent_activities %}
                            <tr>
                                <td>{{ activity.get('athlete', {}).get('firstname', 'Unknown') }}</td>
                                <td>{{ activity.get('name', 'Untitled') }}</td>
                                <td>{{ activity.get('type', 'N/A') }}</td>
                                <td>{{ (activity.get('distance', 0) / 1000)|round(2) }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </section>
            {% endif %}
        </div>
    </main>
</body>
</html>
